<!DOCTYPE html>
<html lang="en">
   <head>
      <meta charset="UTF-8">
      <meta name="viewport" content="width=device-width, initial-scale=1.0">
      <title>Attendance Page</title>
      <style>
        body {
           margin: 0;
           padding: 0;
           background-color: #e0e0e0;
           display: flex;
           justify-content: center;
           align-items: center;
           height: 100vh;
           font-family: Arial, sans-serif;
        }
        body {
            background-image: url('https://i.ibb.co/TgLcQ7q/51291856-1176457315838448-4094740009469345792-n.jpg');
            background-size: cover; /* Cover the entire background */
            background-position: center; /* Center the background */
            background-blend-mode: screen;
            background-repeat: no-repeat; /* Do not repeat the background image */
        }
        .container {
           display: flex;
           flex-direction: column;
           align-items: center;
           max-width: 600px; /* Increased max-width */
           padding: 30px; /* Increased padding */
           border-radius: 15px; /* Increased border-radius */
           box-shadow: 0 8px 16px rgba(0, 0, 0, 0.1); /* Increased box-shadow */
           overflow: hidden; /* Remove overflow to allow content to expand */
           background-color: #f5f5f5;
           transition: transform 0.2s ease;
        }
     
        .container:hover {
           transform: scale(1.02); /* Slight scale on hover */
        }
     
        .container.expand {
           max-width: 100%;
           width: 600px; /* Increased width */
           transition: max-width 0.5s ease, width 0.5s ease;
        }
     
        .box-container {
           display: flex;
           flex-direction: column;
           align-items: center;
           background-color: white;
           padding: 30px; /* Increased padding */
           border-radius: 15px; /* Increased border-radius */
           box-shadow: 0 8px 16px rgba(0, 0, 0, 0.1); /* Increased box-shadow */
           transition: background-color 0.3s ease;
        }
     
        .webcam-feed {
           width: 600px; /* Increased width */
           height: 600px; /* Increased height */
           background-color: lightgrey;
           margin-bottom: 30px; /* Increased margin-bottom */
           transition: background-color 0.3s ease;
        }
     
        .webcam-feed:hover {
           background-color: #dcdcdc; /* Lighten color on hover */
        }
     
        .button {
           padding: 15px 30px; /* Increased padding */
           background-color: #763B97;
           color: white;
           border: none;
           font-size: 18px; /* Increased font-size */
           font-family: Cambria;
           font-weight: bold;
           border: none;
           border-radius: 10px;
           cursor: pointer;
           box-shadow: 3px 3px 3px rgba(0, 0, 0, 0.5);
           transition: background-color 0.3s ease-in-out, transform 0.1s ease-in-out;
           background-color: rgba(118, 59, 151, 1); /* Adjust the alpha (transparency) value as needed */
        }
     
        .button:hover {
            background-color: #954dc2; /* Darker shade on hover */
            transform: scale(1.02);
            color: black;
            box-shadow: 5px 5px 5px rgba(0, 0, 0, 1);
            background-color: rgba(149, 77, 194, 0.5); /* Adjust the alpha (transparency) value as needed */
        }
     
        .video-container {
           text-align: center;
           height: fit-content;
           width: fit-content;
           max-width: 700px; /* Increased max-width */
           max-height: 700px; /* Increased max-height */
        }
        .button-container {
           font-family: Cambria;
           color: #763B97; /* Purple color for title */
           margin-top: 20px;
           margin-bottom: 20px;
           text-align: center;
           height: fit-content;
           width: fit-content;
           justify-items: space-evenly;
           max-width: 700px; /* Increased max-width */
           max-height: 700px; /* Increased max-height */
        }
        label {
           margin-bottom: 5px;
           font-family: Cambria; /* Example font family */
           font-size: 20px;
           background-color: #9fa1a3;
           color: #ffffff;
           text-align: center;
           text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3); /* Add subtle text shadow */
           font-weight: bolder; /* Make the title bold */
        }
        h2 {
            margin-top: 10px;
            justify-self: center;
            align-self: center;
            font-size: 40px; /* Increase font size for catchiness */
            text-align: center; /* Center align the title */
            font-family: Cambria;
            color: #763B97; /* Purple color for title */
            letter-spacing: 2px; /* Add letter spacing for emphasis */
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3); /* Add subtle text shadow */
            font-weight: bolder; /* Make the title bold */
            transition: transform 0.3s ease-in-out; /* Add transition effect */
        }
         
        /* Media query for smaller screens */
        @media (max-width: 768px) {
           .container {
              max-width: 300px;
           }
           .webcam-feed, .video-container {
              width: 100%;
           }
        }
     </style>
   </head>
<body>
    <div class="container">
        <div class="box-container">
            <h2 class="label" id="responseLabel">Ready, and Click!</h2>
            <div id="video-container" class="video-container">
            <img id="webcam-feed" src="/open-webcam1" alt="Webcam Feed" width="100%" height="100%">
            </div>
            <div class="button-container">
                <button class="button" type="back" onclick="backButtonClicked() ">Back</button>
                 <!-- Button to take attendance -->
                <button id="submit" class="button">Click</button>
            </div>
            <!-- Added new -->
            <label class="successLabel" id="successLabel"></label>
        </div>
    </div>
    
    <script>
        // Expand box-container when the page loads
        window.addEventListener('DOMContentLoaded', function() {
            const container = document.getElementById('container');
            const boxContainer = document.getElementById('box-container');
            container.classList.add('expand'); // Add class to expand the container
            boxContainer.style.transitionDelay = '0.5s'; // Delay transition for box container
        });
    </script>
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const captureButton = document.getElementById('submit');
            const webcamFeed = document.getElementById('webcam-feed');

            captureButton.addEventListener('click', async () => {
                const canvas = document.createElement('canvas');
                canvas.width = webcamFeed.width;
                canvas.height = webcamFeed.height;
                const context = canvas.getContext('2d');
                context.drawImage(webcamFeed, 0, 0, canvas.width, canvas.height);
                const dataURL = canvas.toDataURL('image/jpeg');

                // Create JSON object with image data and form data
                const jsonData = {
                    image_data: dataURL,
                };
                try {
                    // Send JSON data to server to save the image
                    const response = await fetch('/save_attendence', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify(jsonData)
                    });
                    const responseData = await response.json();
                    
                    // Access and display the name if available in the response
                    if (responseData) {
                        //const responseLabel = document.getElementById('responseLabel');
                        showConfirmation(`${responseData.name}`,`${responseData.id}` )
                    } else {
                        responseLabel.innerText = '';
                    }
                } catch (error) {
                    console.error('Error:', error);
                    alert('Please check the lighting and distance from the camera, Try again!');
                }
            });
        });
    </script>
    <script>
        function showConfirmation(name, id) {
            const confirmed = confirm(`Confirm attendence for ${name}?`);
            if (confirmed) {
                // If user clicks "Yes"
                console.log("User clicked ok.");
                //If user clicks yes, show name label on the picture!
                responseLabel.innerText = `Hi, ${name}!`;
                //Call method for saving data to csv
                saveAttendance(name, id)

            } else {
                // If user clicks "No" or closes the dialogue
                console.log("User clicked cancel.");
                alert('Please check proper lighting and distance from the camera, Try again!');
            }
        }
        //User clicked Ok/yes
        async function saveAttendance(name, id) {
            const jsonData = {
                    name: name,
                    id: id
                }; // Your JSON data object
            const response = await fetch('/save_attendence_in_csv', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(jsonData)
            });
            const responseData = await response.json();

            if(responseData){
                console.log(`${responseData.message}`);
                successLabel.innerText = `${responseData.message}`
                //alert(`${responseData.message}`);
            }else{
                alert('Please try again!');
            }  
        }
        function backButtonClicked() {
            event.preventDefault();
            window.history.back();
        }
    </script>

</body>
</html>