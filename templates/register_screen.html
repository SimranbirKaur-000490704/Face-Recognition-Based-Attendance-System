<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Student Image Registration Form</title>
        <style>
            * {
                box-sizing: border-box;
            }
            
            .popup {
                display: none;
                position: fixed;
                max-width: 600px;
                top: 50%;
                left: 50%;
                transform: translate(-50%, -50%);
                background-color: #fff;
                padding: 20px;
                font-family: Cambria;
                text-align: center; /* Center align the content */
                border: 2px solid #333;
                box-shadow: 0 0 10px rgba(0, 0, 0, 0.5);
                z-index: 9999;
                border-radius: 20px;
                transition: opacity 0.3s ease; /* Smooth transition for opacity */
            }
            h2 {
                margin-bottom: 20px; /* Add margin below the title */
            }
            .notice-text {
                margin-bottom: 20px; /* Add margin below the long text */
                text-align: justify;
                font-family: Cambria;
                font-size: large;
            }

            .agree-button {
                margin-top: 15px; /* Add margin above the button */
                margin-bottom: 15px;
                font-family: Cambria;
            }
            /* Styling for the overlay */
            .overlay {
                display: none;
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background-color: rgba(0, 0, 0, 0.5);
                z-index: 9998;
                transition: opacity 0.3s ease; /* Smooth transition for opacity */
            }
            /* Styling for the checkbox container */
            .checkbox-container {
                display: flex; /* Use flexbox to align items horizontally */
                flex-direction: row;
                justify-items: center;
                align-items: center;
                align-items: center; /* Center items vertically */
                margin-top: 2%;
                margin-left: -2%;
            }
            /* Adjust the flex property of the input and label */
                input[type="checkbox"] {
                flex: 1; /* Let the checkbox have its default width */
            }

            label {
                flex: 10; /* Let the label fill the remaining space */
                margin-left: 5px; /* Adjust margin left as needed */
            }
            body {
                margin: 0;
                font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
                background-color: #954dc21f;
                display: flex;
                align-items: center;
                justify-content: center;
                height: 100vh;
            }
    
            .container {
                display: flex;
                flex-wrap: wrap;
                width: 200%;
                max-width: 1200px;
                height: 100%;
                max-height: 490px;
                background-color: #fff;
                border-radius: 10px;
                box-shadow: 0 0 20px rgba(0, 0, 0, 0.3);
                overflow: hidden;
            }
    
            .left-half {
                flex: 1.5;
                background-color: #edeaea;
                color: white;
                font-size: 24px;
                display: flex;
                flex-direction: column;
                justify-content: center;
                align-items: center;
                border: 1px solid #ddd;
                border-radius: 15px;
                box-shadow: 0 0 20px rgba(0, 0, 0, 0.2);
                transition: background-color 0.3s ease-in-out;
                overflow: hidden;
            }

            .left-half:hover {
                background-color: #fff; /* Darker shade on hover */
            }

            .right-half {
                flex: 1;
                padding: 20px;
                display: flex;
                flex-direction: column;
                justify-content: center;
                align-items: center;
                max-width: 500px;
            }
    
            form {
                border: 1px solid #ddd;
                padding: 30px;
                max-width: 420px;
                width: 100%;
                height: 100%;
                max-height: 400px;
                background-color: #edeaea; /* Light gray background */
                border-radius: 8px;
                box-shadow: 0 0 20px rgba(0, 0, 0, 0.3);
                transition: background-color 0.3s ease-in-out;
            }
    
            form:hover {
                background-color: #fff; /* White background on hover */
            }
    
            .input-group {
                display: flex;
                flex-direction: column;
                margin-bottom: 15px;
            }
    
            label {
                font-weight: bold;
                margin-bottom: 5px;
                color: #333;
                font-family: Cambria;
                letter-spacing: 0.5px;
            }
    
            input,
            select,
            textarea {
                padding: 10px;
                margin: 10px 0;
                border: 1px solid #ccc;
                border-radius: 4px;
                width: 100%;
                transition: border-color 0.3s ease-in-out;
                letter-spacing: 0.5px;
            }
    
            input:focus,
            select:focus,
            textarea:focus {
                border-color: #3498db; /* Highlight border color on focus */
            }
    
            select {
                appearance: none;
            }
    
            .button-container {
                display: flex;
                flex-direction: row;
                justify-content: space-evenly;
                align-items: center;
                margin-top: 20px;
            }
    
            button {
                background-color: #763B97;
                color: white;
                border: none;
                padding: 10px 20px;
                cursor: pointer;
                border-radius: 5px;
                width: 28%;
                font-size: 17px;
                font-family: Cambria;
                font-weight: bold;
                border: none;
                border-radius: 10px;
                cursor: pointer;
                box-shadow: 3px 3px 3px rgba(0, 0, 0, 0.5);
                transition: background-color 0.3s ease-in-out, transform 0.1s ease-in-out;
                background-color: rgba(118, 59, 151, 1); /* Adjust the alpha (transparency) value as needed */
            }
    
            button:hover {
                background-color: #954dc2; /* Darker shade on hover */
                transform: scale(1.02);
                color: black;
                box-shadow: 5px 5px 5px rgba(0, 0, 0, 1);
                background-color: rgba(149, 77, 194, 0.5); /* Adjust the alpha (transparency) value as needed */
            }
    
            h1 {
                text-align: center;
                margin-bottom: 20px;
                color: #333;
            }
    
            .error {
                color: #e74c3c;
                font-weight: bold;
                margin-bottom: 10px;
            }
    
            @media screen and (max-width: 768px) {
                .container {
                    width: 100%;
                }
            }
        </style>
    </head>
<body>
    <div class="container">
        <div class="left-half">
            <div id="video-container">
                <img id="webcam-feed" src="/open-webcam" alt="Webcam Feed" width="100%" height="100%">
                <!--video id="video" width="100%" height="100%" autoplay></video-->
            </div>
            <!--button id="captureButton">Capture</button-->
        </div>
        <div class="right-half">
            <div id="registration-form"  ></div>
                <form id="myForm" width="100%" height="100%">
                    <label for="studentId">Student ID</label>
                    <input type="text" name="Student Id" placeholder="Enter you Student ID" pattern="\d+" required>
                    <label for="studentName">Student Name</label>
                    <input type="text" name="Student Name" placeholder="Enter you First Name"  pattern="[A-Za-z]+" required>
                    <label for="email">Email ID</label>
                    <input type="email" name="email id" placeholder="Enter you Saskpolytech Email" required>
                    <div class="checkbox-container">
                        <input type="checkbox" id="checkbox" required>
                        <label for="checkbox" >I have read and agree to the Terms and Conditions </label>
                    </div>
                    <div class="button-container">
                        <button type="button" onclick="backButtonClicked() ">Back</button>
                        <button id="submit">Submit</button>
                        <!--button type="submit" onclick="registrationButtonClicked('/')">Submit</button-->
                    </div>
                </form>
            </div>
        </div>
    </div>
    <!-- Popup content -->
    <div class="overlay" id="overlay"></div>
    <div class="popup" id="popup">
        <h2>Notice and Consent</h2>
        <p class="notice-text">
            By proceeding, you consent to the use of your image for the purpose of capturing and documenting moments during the Registration.
            These images may be used in marking your attendances for the courses you are enrolled in.
            We respect your privacy, and we assure you that your image will be used responsibly. 
            The sole use of these images is for taking attendance. 
            If you have any concerns or objections, please refrain from proceeding, and inform your professir about your concern.
            By clicking the "Agree to Terms" button, you acknowledge that you have read and understood the terms outlined above and grant permission for the use of your image as described.
        </p>
        <button class="agree-button" onclick="closePopup()">I Agree</button>
    </div>
    <script>
        // Get references to the popup and overlay
        var popup = document.getElementById('popup');
        var overlay = document.getElementById('overlay');
      
        // Function to open the popup
        function openPopup() {
            popup.style.display = 'block';
            overlay.style.display = 'block';
            popup.style.opacity = '1';
            overlay.style.opacity = '1';
        }
      
        // Function to close the popup
        function closePopup() {
            popup.style.display = 'none';
            overlay.style.display = 'none';
            popup.style.opacity = '0';
            overlay.style.opacity = '0';
        }
      
        // Add click event listener to the checkbox
        document.getElementById('checkbox').addEventListener('click', function() {
          if (this.checked) {
            openPopup();
          } else {
            closePopup();
          }
        });
      </script>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            document.getElementById('myForm').addEventListener('submit', async (event) => {
                event.preventDefault(); // Prevent form submission
                
                const formData = new FormData(event.target); // Get form data
                
                const captureButton = document.getElementById('captureButton');
                const webcamFeed = document.getElementById('webcam-feed');
                const canvas = document.createElement('canvas');
                canvas.width = webcamFeed.width;
                canvas.height = webcamFeed.height;
                const context = canvas.getContext('2d');
                context.drawImage(webcamFeed, 0, 0, canvas.width, canvas.height);
                const dataURL = canvas.toDataURL('image/jpeg');

        
                // Convert form data to object
                const formObject = {};
                formData.forEach((value, key) => {
                    formObject[key] = value;
                });

                // Create JSON object with image data and form data
                const jsonData = {
                    image_data: dataURL,
                    form_data: formObject
                };

                try {
                    // Send JSON data to server to save the image
                    const response = await fetch('/save_image', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify(jsonData)
                    });

                    if (response.ok) {
                        alert('Image captured and data saved successfully!');
                        //back button events, after successfully taking the pictures
                       // event.preventDefault();
                        //window.history.back();
                    } else {
                        alert('Failed to capture and save image.');
                    }
                } catch (error) {
                    console.error('Error:', error);
                    alert('An error occurred while processing the request.');
                }
            });
        });
    </script>
    <script>
        function backButtonClicked() {
            event.preventDefault();
            window.history.back();
        }
    </script>
</body>
</html>
